<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Malludino Control Panel</title>
  <style>
    body{font-family:sans-serif;padding:20px;background:#f0f0f0;}
    ul{list-style:none;padding:0;}
    li{margin:10px 0;background:#fff;padding:10px;border-radius:5px;display:flex;justify-content:space-between;align-items:center;}
    button{margin-left:10px;padding:5px 10px;}
    input{padding:5px;width:200px;}
  </style>
</head>
<body>
  <h1>Malludino Modes Control</h1>
  <ul id="modes-list"></ul>
  <input type="text" id="new-mode" placeholder="New mode">
  <button onclick="addMode()">Add Mode</button>

<script>
const repo = 'ZebbyAnnan-pixel/malludino'; // Replace with your main repo path
const filePath = 'modes.json';
const token = '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'; // Replace with your GitHub personal access token

async function fetchModes() {
  const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`);
  const data = await res.json();
  const content = atob(data.content);
  const json = JSON.parse(content);
  
  const list = document.getElementById('modes-list');
  list.innerHTML = '';
  json.modes.forEach((mode, idx) => {
    const li = document.createElement('li');
    li.textContent = mode;

    const btn = document.createElement('button');
    btn.textContent = 'Delete';
    btn.onclick = () => deleteMode(idx, data.sha, json);
    
    li.appendChild(btn);
    list.appendChild(li);
  });
}

async function addMode() {
  const newMode = document.getElementById('new-mode').value.trim();
  if(!newMode) return alert('Enter a mode name');

  const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`);
  const data = await res.json();
  const content = atob(data.content);
  const json = JSON.parse(content);

  if(json.modes.includes(newMode)) return alert('Mode already exists');
  json.modes.push(newMode);

  await updateFile(json, data.sha);
  document.getElementById('new-mode').value = '';
  fetchModes();
}

async function deleteMode(idx, sha, json) {
  if(!confirm('Delete this mode?')) return;
  json.modes.splice(idx, 1);
  await updateFile(json, sha);
  fetchModes();
}

async function updateFile(json, sha) {
  await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: 'Update modes',
      content: btoa(JSON.stringify(json, null, 2)),
      sha: sha
    })
  });
}

fetchModes();
</script>
</body>
</html>
